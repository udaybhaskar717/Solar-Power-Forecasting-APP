# -*- coding: utf-8 -*-
"""StreamLit.py

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1z0NmQedL93p60Eo5rTnS4bCqun0Yy86I
"""
import streamlit as st
import joblib
import pandas as pd
from datetime import datetime
import pickle
import tensorflow as tf
# filename = 'https://github.com/udaybhaskar717/Solar-Power-Forecasting-APP/blob/main/stack_reg_1.pkl'
# with open(filename, 'rb') as file:
#     my_model = pickle.load(file)
model = tf.keras.models.load_model("stack_reg_1.pkl")

# # load the trained model
# model = my_model

# define a function to make predictions
def predict_solar_power(df):
    # make predictions using the loaded model
    predictions = model.predict(df)
    return predictions

# create a function to get user inputs
def get_user_inputs():
    st.header("Enter the weather data:")
    date = st.date_input("Date", datetime.now().date())
    Ambinet_temp = st.number_input("Temperature (°C)", value=25.0)
    Module_temp = st.number_input("Temperature (°C)", value=25.0)
    Irradiance = st.number_input("Irradiance (W/m^2)", value=1000.0)
    # wind_speed = st.number_input("Wind Speed (m/s)", value=3.0)
    # pressure = st.number_input("Pressure (hPa)", value=1013.0)

    # create a DataFrame with the user inputs
    user_inputs = pd.DataFrame({
        'AMBIENT_TEMPERATURE': [Ambinet_temp],
        'MODULE_TEMPERATURE':[Module_temp],
        'IRRADIATION': [Irradiance]
        # 'Wind Speed': [wind_speed],
        # 'Pressure': [pressure]
    })

    # add a new column with the date
    user_inputs['Date'] = pd.to_datetime(date)
    user_inputs.set_index('Date', inplace=True)

    return user_inputs

# create the app
def main():
    st.title("Solar Power Forecasting App")

    # get user inputs
    user_inputs = get_user_inputs()

    # make predictions
    predictions = predict_solar_power(user_inputs)

    # display the predictions
    st.subheader("Predicted solar power output:")
    st.write(f"{predictions[0]:.2f} kW")

if __name__ == '__main__':
    main()
